language: java
jdk:
- openjdk7
sudo: required
before_script:
- cd $HOME
- sudo apt-get install -y lzop git-core gnupg flex bison gperf build-essential zip
  curl zlib1g-dev gcc-multilib g++-multilib libc6-dev-i386 lib32ncurses5-dev x11proto-core-dev
  libx11-dev lib32z-dev ccache libgl1-mesa-dev libxml2-utils xsltproc unzip maven
  schedtool &> /dev/null
- git clone https://sumitrajdev@bitbucket.org/sumitrajdev/twrp-5.1.1.git $HOME/tmp
- mv $HOME/tmp/twrp-5.1.1.tar.xz $HOME/twrp.tar.xz
- rm -rf tmp
- wget https://github.com/TwrpBuilder/twrp-5.1.1-source/releases/download/initial/twrp-5.1.1.tar.xz
  -O $HOME/twrp.tar.xz
- tar -xvf twrp.tar.xz &> log
script:
- cd $HOME/twrp
- git clone https://github.com/TwrpBuilder/android_device_nokia_normandy.git &>
  /dev/null
- rm -rf bootable/recovery
- git clone https://github.com/omnirom/android_bootable_recovery.git bootable/recovery
  &> /dev/null
- source build/envsetup.sh ; lunch omni_normandy-eng
- make -j4 bootimage
- make -j4 recoveryimage &> log
- mkazip_normandy
- curl --upload-file "./log" "https://transfer.sh/log"
- cd out/target/product/normandy/
- curl --upload-file "./recovery.img" "https://transfer.sh/recovery.img"
- echo "####Made Zip#####"
- curl --upload-file "./twrp-$(date +%Y%m%d)-3.0.3-UNOFFICIAL-normandy.zip" "https://transfer.sh/twrp-$(date
  +%Y%m%d)-3.0.3-UNOFFICIAL-normandy.zip"
deploy:
  skip_cleanup: true
  provider: releases
  api_key:
    secure: AEI3DV+zwyy0DCMV8NlzUKHEO9hl0Zb0WsnVSDcsmd9qwmMODMxy9+1ufG83/Ef0FpDXr+yf7B95fQMPhlfgLAzQ1SsAdg7Y1XGKVPsTJU3S027VEifX2PsuSmlYIrSIZa34ODWoQJzT9rAavTMqCC7f2P0pwOa2TxxXok6OX0vdxvC+9ItZ3aY1nElAzS19iI+mSRiDcPiuYC3SNUFpZqma4iNmytQNbxfsCxYRB1HMg1WBM+qu9hoOqAcoEii5iQ1A/6jCkQb4FK7mhv3qTPsNrKGsRgYtEGax/zlY8sWrn4Ei+P01icpE7OLXJy2AWNV7Tejcyq8qFrvudYovbmNs8qVrA5Lijsp1epW0PS1VBE09j/pdDqe2DTc6ayMu4GosQ+A2G5zISfln8QwyOk8CFxU28pZKTR8zv9qleNqNggHvRHxmEsecm1LfH0MxaSrA2D032VcFXw4a20IfFMM13NsSy/a9ZpSXpcfh9TnMOLG6mgCeD/qq7oDo1sf9Eziv2MFjg/VNCnHxFhfkhW4fTlAs28W/OwgiClcrsSvTpS1/E+i9m1OFBKc3yLHOWIghtv62h7xctLtjZBylp4R0Qa/NcoZqsbopuK4rnA1q7T0oXn1mZiFO0Zal3VtjjabbH4Hb9uQLzi+2g25hWpSbB4ehTZ16om6lTHR+Hbo=
  file: "$HOME/twrp/out/target/product/normandy/recovery.img"
  on:
    repo: TwrpBuilder/android_device_nokia_normandy
